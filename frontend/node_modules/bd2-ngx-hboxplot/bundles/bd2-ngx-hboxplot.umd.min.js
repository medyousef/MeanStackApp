!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("d3")):"function"==typeof define&&define.amd?define("bd2-ngx-hboxplot",["exports","@angular/core","d3"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["bd2-ngx-hboxplot"]={},t.ng.core,t.d3lib)}(this,(function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var r=i(n),o=function(){this.vMargin=25,this.hMarginL=20,this.hMarginR=15,this.rowWidth=30,this.rowGap=.2,this.transitionTime=600,this.boxStrokeWidth="2px",this.boxFillOpacity=.35,this.meanStrokeWidth="4px",this.labelFont="12px",this.labelFillOpacity=.35,this.backLabelOpacity=.3,this.backdropColor="white",this.backdropOpacity=1,this.whiskerStrokeWidth="1px",this.outliersStrokeWidth="1px",this.outliersCircleRadius=3,this.outliersFillOpacity=.4},a=function(){this.labelsTimers=[]};function s(t,e,n){var i=n.range(),r=n(t)+e;return r<i[0]?i[0]:r>i[1]?i[1]:r}var l=function(){this.outliers=[]},c=function(){function t(){}return t.prototype.dataToBoxes=function(t){var e=this;return t?t.map((function(t,n){var i=e.datumToBox(t);return i.ix=n,i.key=n+1+".",i})):[]},t.prototype.datumToBox=function(t){var e=new l;if(!t||0===t.length)return e;t=t.sort(r.ascending),e.mean=r.mean(t),e.median=r.median(t),e.fstQnt=r.quantile(t,.25),e.thrdQnt=r.quantile(t,.75);var n=1.5*(e.thrdQnt-e.fstQnt);e.lowWskr=e.fstQnt-n,e.highWskr=e.thrdQnt+n;for(var i=0;i<t.length;i++)if(t[i]>=e.lowWskr){e.lowWskr=t[i];break}for(i=t.length-1;i>=0;i--)if(t[i]<=e.highWskr){e.highWskr=t[i];break}return e.outliers=t.filter((function(t){return t<e.lowWskr||t>e.highWskr})),e},t.prototype.mockEmptyValues=function(t,e){t.forEach((function(t){void 0!==t.mean&&null!==t.mean||(t.mean=e,t.median=e,t.fstQnt=e,t.thrdQnt=e,t.lowWskr=e,t.highWskr=e)}))},t}(),p=function(){function t(){}return t.extendPalette=function(t,e){t&&0!==t.length||(t=["black"]);for(var n=[],i=0;i<e;i++)n.push(t[i%t.length]);return n},t.palette=function(e){return e<=t.schemeCategory10.length?t.extendPalette(t.schemeCategory10,e):t.extendPalette(t.schemeCategory20,e)},t}();p.schemeCategory10=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],p.schemeCategory20=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];var h=function(){function t(){}return t.round=function(t,e){return e=e||t,(e=Math.abs(e))<.01?t:e<1?Math.round(1e4*t)/1e4:e<1e3?Math.round(100*t)/100:Math.round(t)},t}(),u=function(){function t(t,n,i){this.ngZone=t,this.changeDetectorRef=n,this.hidden=!1,this.removed=[],this.domain=[17,36],this.palette=[],this.labels=[],this.labelsOn="always",this.lookAndFeel=new o,this.sortChanged=!1,this.colors=new e.EventEmitter,this.graphicContext=new a,this.boxUtil=new c,this.sortFunction=function(t,e){return t.ix-e.ix},this.d3=r,this.parentNativeElement=i.nativeElement}return Object.defineProperty(t.prototype,"sorted",{set:function(t){this.sortFunction="median"===t?function(t,e){return t.median-e.median}:"label"===t?function(t,e){return t.label===e.label?0:t.label<e.label?-1:1}:function(t,e){return t.ix-e.ix}},enumerable:!1,configurable:!0}),t.prototype.ngAfterViewInit=function(){this.changeDetectorRef.detach()},t.prototype.ngOnChanges=function(t){this.changeDetectorRef.detectChanges(),this.initSVG(),this.data&&(this.sortChanged=void 0!==t.sorted,this.hidden||this.updatePlot())},t.prototype.isDataUpdate=function(t){return t.data||t.removed||t.domain||t.palette||t.labels},t.prototype.initSVG=function(){if(!this.d3Svg){var t=this.d3.select(this.parentNativeElement);this.d3Svg=t.select(".hbox-plot").append("svg"),this.d3Svg.attr("width","0")}},t.prototype.ngOnInit=function(){null!==this.parentNativeElement||console.error("Missing parrent element for the component")},t.prototype.ngOnDestroy=function(){this.d3Svg&&this.d3Svg.empty&&!this.d3Svg.empty()&&this.d3Svg.selectAll("*").remove()},t.prototype.testGraphicContext=function(t){this.graphicContext=t},t.prototype.updatePlot=function(){var t=this;this.lookAndFeel.transitionTime>0?(this.graphicContext.transitionOn=!0,this.ngZone.runOutsideAngular((function(){t.graphicContext.transition=t.d3.transition().duration(t.lookAndFeel.transitionTime)}))):(this.graphicContext.transitionOn=!1,this.graphicContext.transition=void 0),this.graphicContext=this.updatePalette(this.data,this.palette,this.graphicContext);var e=this.prepareDataModel(this.data,this.removed,this.labels,this.graphicContext.palette,this.domain,this.sortFunction);e=e.filter((function(t){return!t.hidden})),this.graphicContext=this.preparePane(e,this.lookAndFeel,this.graphicContext),this.graphicContext=this.prepareScales(e,this.domain,this.lookAndFeel,this.graphicContext),this.graphicContext=this.plotAxisBox(e,this.domain,this.lookAndFeel,this.mainPane,this.graphicContext),this.graphicContext=this.plotDataBoxes(e,this.lookAndFeel,this.mainPane,this.graphicContext),this.graphicContext=this.prepareTooltip(this.mainPane,this.graphicContext),this.graphicContext=this.prepareLabels(e,this.mainPane,this.lookAndFeel,this.graphicContext,this.labelsOn)},t.prototype.prepareDataModel=function(t,e,n,i,r,o){var a=this.boxUtil.dataToBoxes(t);return this.boxUtil.mockEmptyValues(a,r[1]),this.labelBoxes(a,n),this.colorBoxes(a,i),e.forEach((function(t){a[t]&&(a[t].hidden=!0)})),a=a.sort(o)},t.prototype.updatePalette=function(t,e,n){return e&&0!==e.length?n.palette=p.extendPalette(e,t.length):n.palette=p.palette(t.length),this.colors.next(n.palette.slice()),n},t.prototype.colorBoxes=function(t,e){t.forEach((function(t){return t.color=e[t.ix]}))},t.prototype.preparePane=function(t,e,n){this.mainPane||(this.d3Svg.attr("width","100%"),this.mainPane=this.d3Svg.append("g"),this.mainPane.classed("mainPane",!0));var i=this.calculateWorkspaceHeight(t,e)+2*e.vMargin;return(n.transitionOn?this.d3Svg.transition(n.transition):this.d3Svg).attr("viewBox","0 0 500 "+i),this.mainPane.attr("transform","translate("+e.hMarginL+","+e.vMargin+")"),n.workspaceWidth=500-e.hMarginL-e.hMarginR,n.workspaceHeight=i-2*e.vMargin,n},t.prototype.calculateWorkspaceHeight=function(t,e){return e.rowWidth*t.length},t.prototype.labelBoxes=function(t,e){e||(e=[]),t.forEach((function(t,n){t.label=e[n]?e[n]:""+(n+1)}))},t.prototype.prepareLabels=function(t,e,n,i,o){i.labelsWrapper||(i.labelsWrapper=e.append("g").classed("labelsWrapper",!0)),i.backLabelsWrapper||(i.backLabelsWrapper=e.insert("g","g.dataWrapper").classed("backLabelsWrapper",!0));var a="always"===o,s="always"===o||"trigger"===o,l=i.labelsWrapper.selectAll("g.yLabel").data(s?t:[],(function(t){return t.key}));l.exit().remove();var c=l.enter().append("g").classed("yLabel",!0);this.ngZone.runOutsideAngular((function(){c.on("mouseover",(function(t,e){r.select(this).selectAll(".yLabel").style("display",null)})).on("mouseout",(function(){r.select(this).selectAll(".yLabel").style("display","none")}))})),c.append("rect").attr("class","yTrigger").style("fill-opacity",1),c.append("rect").attr("class","yLabel").style("fill-opacity",.35).style("display","none"),c.append("text").attr("class","yLabel").attr("text-anchor","left").attr("dominant-baseline","central").style("font-size",n.labelFont).style("opacity",1).attr("x",5);var p=i.backLabelsWrapper.selectAll("g.yLabel").data(a?t:[],(function(t){return t.key}));p.exit().remove();var h=p.enter().append("g").classed("yLabel",!0);h.append("text").attr("class","yLabel").attr("text-anchor","left").attr("dominant-baseline","central").style("font-size",n.labelFont).style("opacity",n.backLabelOpacity).attr("x",5);var u=c.merge(l),d=h.merge(p);i.labelsTimers.forEach((function(t){return clearTimeout(t)})),i.labelsTimers=[];var y=setTimeout((function(){var t=[];u.select("text").style("display",null).attr("y",(function(t){return i.yScale(t.key)+i.yScale.bandwidth()/2})).text((function(t){return t.label})).each((function(e){t.push(this.getBBox())})).style("display","none");var e=d.select("text");(e=i.transitionOn?e.transition(i.transition):e).attr("y",(function(t){return i.yScale(t.key)+i.yScale.bandwidth()/2})).text((function(t){return t.label}));var r=u.select(".yTrigger").style("fill",(function(t){return t.color})).style("stroke",(function(t){return t.color})).data(t);(r=i.transitionOn?r.transition(i.transition):r).attr("x",-7).attr("y",(function(t){return t.y-3})).attr("width",(function(t){return 7})).attr("height",(function(t){return t.height+6})),u.select("rect.yLabel").style("fill",(function(t){return t.color})).style("fill-opacity",n.labelFillOpacity).data(t).attr("x",0).attr("y",(function(t){return t.y-3})).attr("width",(function(t){return t.width+10})).attr("height",(function(t){return t.height+7}))}),10);return i.labelsTimers.push(y),i},t.prototype.prepareTooltip=function(t,e){return e.tooltipWrapper||(e.tooltipWrapper=t.append("g").classed("tooltipWrapper",!0),e.tooltipBox=e.tooltipWrapper.append("rect").style("fill","white").style("fill-opacity",.8).style("stroke","grey"),e.tooltipText=e.tooltipWrapper.append("text").attr("class","tooltip").attr("text-anchor","middle").style("opacity",1),e.tooltipWrapper.style("display","none")),e},t.prototype.showTooltip=function(t,e,n){if(this.graphicContext.tooltipText){this.graphicContext.tooltipText.attr("x",this.graphicContext.xScale(e)).attr("y",this.graphicContext.yScale(n)).text(h.round(t)),this.graphicContext.tooltipWrapper.style("display",null);var i=this.graphicContext.tooltipText.node().getBBox();this.graphicContext.tooltipBox.attr("x",i.x-3).attr("y",i.y-2).attr("width",i.width+6).attr("height",i.height+4)}},t.prototype.hideTooltip=function(){this.graphicContext.tooltipText&&this.graphicContext.tooltipWrapper.style("display","none")},t.prototype.prepareScales=function(t,e,n,i){i.xScale||(i.xScale=r.scaleLinear().clamp(!0)),i.xScale.domain(e).range([0,i.workspaceWidth]),i.yScale||(i.yScale=r.scaleBand().padding(n.rowGap));var o=t.map((function(t){return t.key}));return i.yScale.domain(o).range([0,i.workspaceHeight]),i},t.prototype.plotAxisBox=function(t,e,n,i,r){return r.axisWrapper||(r.axisWrapper=this.initAxisWrapper(i)),r=this.plotHorizontalScales(e,n,r),r=this.plotVerticalScales(t,n,r)},t.prototype.initAxisWrapper=function(t){var e=t.select(".axisWrapper");return 0===e.size()&&((e=t.append("g").attr("class","axisWrapper")).append("g").attr("class","xTopAxis"),e.append("g").attr("class","xBottomAxis"),e.append("g").attr("class","yLeftAxis"),e.append("g").attr("class","yRightAxis")),e},t.prototype.plotHorizontalScales=function(t,e,n){n.xTopAxis||(n.xTopAxis=r.axisTop(n.xScale)),n.xBottomAxis||(n.xBottomAxis=r.axisBottom(n.xScale)),n.axisWrapper.select("g.xTopAxis").call(n.xTopAxis);var i=n.axisWrapper.select("g.xBottomAxis");return(i=n.transitionOn?i.transition(n.transition):i).attr("transform","translate(0,"+n.workspaceHeight+")").call(n.xBottomAxis),n},t.prototype.plotVerticalScales=function(t,e,n){n.yLeftAxis||(n.yLeftAxis=r.axisLeft(n.yScale).tickFormat((function(){return""}))),n.yRightAxis||(n.yRightAxis=r.axisRight(n.yScale).tickValues([]));var i=n.axisWrapper.select("g.yLeftAxis");return(i=n.transitionOn?i.transition(n.transition):i).call(n.yLeftAxis),i=n.axisWrapper.select("g.yRightAxis").attr("transform","translate("+n.workspaceWidth+",0)"),(i=n.transitionOn?i.transition(n.transition):i).call(n.yRightAxis),n},t.prototype.plotDataBoxes=function(t,e,n,i){i.dataWrapper||(i.dataWrapper=n.append("g").attr("class","dataWrapper"));var r=i.dataWrapper.selectAll(".boxWidget");r=r.data(t,(function(t){return t.key})),this.updateBoxWidgets(r,e,i);var o=r.enter().append("g").attr("class","boxWidget");return this.createBoxWidgets(o,e,i),r.exit().remove(),i},t.prototype.updateBoxWidgets=function(t,e,n){t.select("rect.backdrop").call(this.positionBackdrop,n),this.updateWhiskers(t.select("g.whiskers"),n),t.select("g.box rect").call(this.positionBoxRectangle,n),t.select("g.box line.medianline").call(this.positionMedianLine,n),t.select("g.box line.meanline").call(this.positionMeanLine,n);var i=t.select("g.outliers").selectAll(".outlier").data((function(t){return t.outliers.map((function(e){return[e,t.key,t.color]}))}));i.enter().call(this.createOutlier,e,n,this.positionOutlier),i.call(this.positionOutlier,n),i.exit().remove()},t.prototype.positionBackdrop=function(t,e){(t=e.transitionOn?t.transition(e.transition):t).attr("x",(function(t){return s(t.lowWskr,-5,e.xScale)})).attr("y",(function(t){return e.yScale(t.key)})).attr("width",(function(t){var n=s(t.lowWskr,-5,e.xScale);return s(t.highWskr,5,e.xScale)-n})).attr("height",(function(t){return e.yScale.bandwidth()}))},t.prototype.positionBoxRectangle=function(t,e){(t=e.transitionOn?t.transition(e.transition):t).attr("x",(function(t){return e.xScale(t.fstQnt)})).attr("y",(function(t){return e.yScale(t.key)})).attr("width",(function(t){return e.xScale(t.thrdQnt)-e.xScale(t.fstQnt)})).attr("height",(function(t){return e.yScale.bandwidth()})).style("stroke",(function(t){return t.color})).style("fill",(function(t){return t.color}))},t.prototype.positionMedianLine=function(t,e){(t=e.transitionOn?t.transition(e.transition):t).attr("x1",(function(t,n){return e.xScale(t.median)})).attr("y1",(function(t,n){return e.yScale(t.key)})).attr("x2",(function(t,n){return e.xScale(t.median)})).attr("y2",(function(t,n){return e.yScale(t.key)+e.yScale.bandwidth()})).style("stroke",(function(t){return t.color})).style("display",(function(t){return t.mean===t.median?"none":null}))},t.prototype.positionMeanLine=function(t,e){(t=e.transitionOn?t.transition(e.transition):t).attr("x1",(function(t,n){return e.xScale(t.mean)})).attr("y1",(function(t,n){return e.yScale(t.key)})).attr("x2",(function(t,n){return e.xScale(t.mean)})).attr("y2",(function(t,n){return e.yScale(t.key)+e.yScale.bandwidth()})).style("stroke",(function(t){return t.color}))},t.prototype.positionOutlier=function(t,e){(t=e.transitionOn?t.transition(e.transition):t).attr("cx",(function(t){return e.xScale(t[0])})).attr("cy",(function(t){return e.yScale(t[1])+e.yScale.bandwidth()/2})).style("stroke",(function(t){return t[2]})).style("fill",(function(t){return t[2]}))},t.prototype.createOutlier=function(t,e,n,i){t.append("circle").attr("class","outlier").attr("r",e.outliersCircleRadius).style("stroke-width",e.outliersStrokeWidth).style("fill-opacity",e.outliersFillOpacity).call(i,n)},t.prototype.positionWhiskerLine=function(t,e,n){(t=n.transitionOn?t.transition(n.transition):t).attr("x1",(function(t,i){return e?n.xScale(t.lowWskr):n.xScale(t.thrdQnt)})).attr("y1",(function(t,e){return n.yScale(t.key)+n.yScale.bandwidth()/2})).attr("x2",(function(t,i){return e?n.xScale(t.fstQnt):n.xScale(t.highWskr)})).attr("y2",(function(t,e){return n.yScale(t.key)+n.yScale.bandwidth()/2})).style("stroke",(function(t){return t.color})).style("display",(function(t){return e&&t.lowWskr===t.fstQnt||!e&&t.highWskr===t.thrdQnt?"none":null}))},t.prototype.positionWhiskerTip=function(t,e,n){(t=n.transitionOn?t.transition(n.transition):t).attr("x1",(function(t,i){return e?n.xScale(t.lowWskr):n.xScale(t.highWskr)})).attr("y1",(function(t,e){return n.yScale(t.key)})).attr("x2",(function(t,i){return e?n.xScale(t.lowWskr):n.xScale(t.highWskr)})).attr("y2",(function(t,e){return n.yScale(t.key)+n.yScale.bandwidth()})).style("stroke",(function(t){return t.color})).style("display",(function(t){return e&&t.lowWskr===t.fstQnt||!e&&t.highWskr===t.thrdQnt?"none":null}))},t.prototype.updateWhiskers=function(t,e){t.select("line.whiskerlineL").call(this.positionWhiskerLine,!0,e),t.select("line.whiskerlineR").call(this.positionWhiskerLine,!1,e),t.select("line.whiskertipL").call(this.positionWhiskerTip,!0,e),t.select("line.whiskertipR").call(this.positionWhiskerTip,!1,e)},t.prototype.createWhiskers=function(t,e,n){t.append("line").attr("class","whiskerlineL").style("stroke-width",e.whiskerStrokeWidth).style("stroke-dasharray","4 3").call(this.positionWhiskerLine,!0,n),t.append("line").attr("class","whiskerlineR").style("stroke-width",e.whiskerStrokeWidth).style("stroke-dasharray","4 3").call(this.positionWhiskerLine,!1,n),t.append("line").attr("class","whiskertipL").style("stroke-width",e.whiskerStrokeWidth).call(this.positionWhiskerTip,!0,n),t.append("line").attr("class","whiskertipR").style("stroke-width",e.whiskerStrokeWidth).call(this.positionWhiskerTip,!1,n)},t.prototype.createBoxes=function(t,e,n){var i=t.append("rect").attr("class","box").style("stroke-width",e.boxStrokeWidth).style("fill-opacity",e.boxFillOpacity).call(this.positionBoxRectangle,n),r=t.append("line").attr("class","medianline").style("stroke-width",e.boxStrokeWidth).call(this.positionMedianLine,n),o=this;this.ngZone.runOutsideAngular((function(){i.on("mouseover",(function(t,e){o.showTooltip(e.median,e.median,e.key)})).on("mouseout",(function(){o.hideTooltip()})),r.on("mouseover",(function(t,e){o.showTooltip(e.median,e.median,e.key)})).on("mouseout",(function(){o.hideTooltip()}))}));var a=t.append("line").attr("class","meanline").style("stroke-width",e.meanStrokeWidth).style("stroke-dasharray","4 2").call(this.positionMeanLine,n);this.ngZone.runOutsideAngular((function(){a.on("mouseover",(function(t,e){o.showTooltip(e.mean,e.mean,e.key)})).on("mouseout",(function(){o.hideTooltip()}))}))},t.prototype.createBoxWidgets=function(t,e,n){t.append("rect").attr("class","backdrop").style("fill-opacity",e.backdropOpacity).style("fill",e.backdropColor).call(this.positionBackdrop,n);var i=t.append("g").attr("class","whiskers");this.createWhiskers(i,e,n);var r=t.append("g").attr("class","box");this.createBoxes(r,e,n),t.append("g").attr("class","outliers").selectAll(".outlier").data((function(t){return t.outliers.map((function(e){return[e,t.key,t.color]}))})).enter().call(this.createOutlier,e,n,this.positionOutlier)},t}();u.decorators=[{type:e.Component,args:[{selector:"bd2-ngx-hbox-plot",changeDetection:e.ChangeDetectionStrategy.OnPush,template:'\n    <div class="hbox-plot" [hidden]="hidden"></div>\n  ',styles:["\n      :host /deep/ .axisWrapper path {\n        stroke: gray;\n      }\n\n      :host /deep/ .axisWrapper line {\n        stroke: gray;\n      }\n\n      :host /deep/ .axisWrapper text {\n        fill: gray;\n      }\n    "]}]}],u.ctorParameters=function(){return[{type:e.NgZone},{type:e.ChangeDetectorRef},{type:e.ElementRef}]},u.propDecorators={hidden:[{type:e.Input}],data:[{type:e.Input}],removed:[{type:e.Input}],domain:[{type:e.Input}],palette:[{type:e.Input}],labels:[{type:e.Input}],labelsOn:[{type:e.Input}],lookAndFeel:[{type:e.Input}],sorted:[{type:e.Input}],colors:[{type:e.Output}]};var d=function(){};d.decorators=[{type:e.NgModule,args:[{declarations:[u],imports:[],exports:[u]}]}],t.BD2NgxHBoxplotModule=d,t.HBoxPlotComponent=u,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=bd2-ngx-hboxplot.umd.min.js.map